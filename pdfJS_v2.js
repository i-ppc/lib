"use strict";var container,sidebar,topbar,lastPointX,lastPointY,pdfJs=window.pdfJs=window.pdfJs||{},CSS_CLASS_NAMES={page_frame:"pf",page_content_box:"pc",page_data:"pi",background_image:"bi",link:"l",input_radio:"ir",__dummy__:"no comma",element_Layer:"mlayer",draw_Layer:"drawBoardReal",drawon_Layer:"drawBoard"},DEFAULT_CONFIG={container_id:["page-container"],topbar_id:"topbar",sidebar_id:"sidebar",outline_id:"outline",loading_indicator_cls:"loading-indicator",preload_pages:4,render_timeout:200,scale_step:.9,key_handler:!0,hashchange_handler:!0,view_history_handler:!0,__dummy__:"no comma"},EPS=1e-6,utils={},initiated=!1,moved=!1,doublePage=!1,EbookMode=1,hasBookMark=!0,viewCounter=0;function invert(e){var t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[3]*e[4])/t,(e[1]*e[4]-e[0]*e[5])/t]}function transform(e,t){return[e[0]*t[0]+e[2]*t[1]+e[4],e[1]*t[0]+e[3]*t[1]+e[5]]}function get_page_number(e){return parseInt(e.getAttribute("data-page-no"),16)}function disable_dragstart(e){for(var t=0,i=e.length;t<i;++t)e[t].addEventListener("dragstart",function(){return!1},!1)}function handleEvent(e){switch(e.type){case"touchstart":case"pointerdown":case"MSPointerDown":case"mousedown":dragstart(e);break;case"touchmove":case"pointermove":case"MSPointerMove":case"mousemove":dragmove(e);break;case"touchend":case"pointerup":case"pointerout":case"MSPointerUp":case"mouseup":case"touchcancel":case"pointercancel":case"MSPointerCancel":case"mousecancel":case"mouseout":dragend(e);break;case"orientationchange":case"resize":break;case"transitionend":case"webkitTransitionEnd":case"oTransitionEnd":case"MSTransitionEnd":break;case"wheel":case"DOMMouseScroll":case"mousewheel":this._wheel(e)}}function dragstart(e){var t=e;e.target;e.preventDefault(),e.stopPropagation(),initiated=!0,moved=!1,lastPointX=t.pageX,lastPointY=t.pageY,container.addEventListener("pointermove",handleEvent),sidebar.addEventListener("pointerup",handleEvent),topbar.addEventListener("pointerup",handleEvent)}function dragmove(e){var t,i,a=e;t=a.pageX-lastPointX,lastPointX=a.pageX,i=a.pageY-lastPointY,lastPointY=a.pageY,container.scrollLeft-=t,container.scrollTop-=i,e.preventDefault(),e.stopPropagation()}function dragend(e){initiated&&(initiated=!1,e.preventDefault(),e.stopPropagation(),container.removeEventListener("pointermove",handleEvent),sidebar.removeEventListener("pointerup",handleEvent),topbar.removeEventListener("pointerup",handleEvent))}function clone_and_extend_objs(e){for(var t={},i=0,a=arguments.length;i<a;++i){var n=arguments[i];for(var s in n)n.hasOwnProperty(s)&&(t[s]=n[s])}return t}function Page(e){if(e){this.loaded=!1,this.shown=!1,this.page=e,this.num=get_page_number(e),this.original_height=e.clientHeight,this.original_width=e.clientWidth;var t=e.getElementsByClassName(CSS_CLASS_NAMES.page_content_box)[0],i=e.getElementsByClassName(CSS_CLASS_NAMES.element_Layer)[0],a=e.getElementsByClassName(CSS_CLASS_NAMES.draw_Layer),n=e.getElementsByClassName(CSS_CLASS_NAMES.drawon_Layer)[0];i&&(this.elLayer=i),a&&(this.drawLayer=a),n&&(this.drawonLayer=n),t&&(this.content_box=t,this.original_scale=this.cur_scale=this.original_height/t.clientHeight,this.page_data=JSON.parse(e.getElementsByClassName(CSS_CLASS_NAMES.page_data)[0].getAttribute("data-data")),this.ctm=this.page_data.ctm,this.ictm=invert(this.ctm),this.loaded=!0)}}function Viewer(e){this.config=clone_and_extend_objs(DEFAULT_CONFIG,arguments.length>0?e:{}),this.pages_loading=[],this.init_before_loading_content();var t=this;document.addEventListener("DOMContentLoaded",function(){t.init_after_loading_content()},!1)}utils.options={disablePointer:!1,bindToWrapper:!0,disableMouse:!1},utils.hasPointer=!(!window.PointerEvent&&!window.MSPointerEvent),utils.addEvent=function(e,t,i,a){e.addEventListener?e.addEventListener(t,i,!!a):e.attachEvent(t,i)},utils.removeEvent=function(e,t,i,a){e.removeEventListener(t,i,!!a)},utils.prefixPointerEvent=function(e){return window.MSPointerEvent?"MSPointer"+e.charAt(7).toUpperCase()+e.substr(8):e},Page.prototype={hide:function(){this.loaded&&this.shown&&(this.content_box.classList.remove("opened"),this.content_box.classList.add("closed"),this.page.classList.remove("opened"),this.page.classList.add("closed"),this.shown=!1)},show:function(){this.loaded&&!this.shown&&(this.content_box.classList.add("opened"),this.content_box.classList.remove("closed"),this.page.classList.add("opened"),this.page.classList.remove("closed"),this.shown=!0)},svgBBox:function(e){let t=document.createElement("div");t.setAttribute("style","position:absolute; visibility:hidden; width:0; height:0"),document.body.appendChild(t);let i=document.createElementNS("http://www.w3.org/2000/svg","svg");t.appendChild(i);let a=e.cloneNode(!0);i.appendChild(a);let n=a.getBBox();return document.body.removeChild(t),n},scaleTo:function(e,t){var i=this.page.style;i.width=this.original_width*e+"px",i.height=this.original_height*e+"px";var a=this.content_box.style;if(a.msTransform=a.webkitTransform=a.transform="scale("+e+")",a.msTransformOrigin=a.webkitTransformOrigin=a.transformOrigin="top left",this.elLayer){var n=this.elLayer.style;n.msTransform=n.webkitTransform=n.transform="scale("+e+")",n.msTransformOrigin=n.webkitTransformOrigin=n.transformOrigin="top left"}if(this.drawLayer)for(var s,o=this.drawLayer,r=0;r<o.length;r++){s=o[r];for(const e of s.childNodes){var l,c=0,d=0,h=0,p=0;if(e.getAttribute("id")&&(l=SVG.get(e.getAttribute("id"))),"defs"!=l.type){"rect"==l.type?(c=l.x(),d=l.y(),h=l.width(),p=l.height()):"path"==l.type||"line"==l.type?(c=this.svgBBox(e).x,d=this.svgBBox(e).y,h=this.svgBBox(e).width,p=this.svgBBox(e).height):"ellipse"==l.type&&(c=l.x(),d=l.y(),h=l.rx(),p=l.ry());var g=h/t*this.cur_scale,_=p/t*this.cur_scale;c=c/t*this.cur_scale,d=d/t*this.cur_scale,"rect"==l.type?(l.size(g,_),l.move(c,d)):"path"==l.type||"line"==l.type?(l.size(g,_),l.move(c,d)):"ellipse"==l.type&&(l.rx(g),l.ry(_),l.move(c,d))}}}if(this.drawonLayer)this.drawonLayer.style},rescale:function(e,t){var i=this.cur_scale;this.cur_scale=0===e?this.original_scale:e;var a=this.page.style;parseInt(this.page.getAttribute("data-page-no")),container.clientWidth,this.original_width,this.original_height;if(0==doublePage){var n=(container.clientWidth-this.original_width*this.cur_scale)/2;this.scaleTo(this.cur_scale,i),a.left=n>0?n+"px":"0px"}else{if(resetZoom)this.cur_scale=container.clientWidth/this.original_width/2,t.scale=this.cur_scale,this.scaleTo(this.cur_scale,i);else{container.clientWidth,this.page.clientWidth;this.scaleTo(this.cur_scale,i)}n=(container.clientWidth-2*this.page.clientWidth)/2;(this.cur_scale>=1||n<0||this.page.clientWidth<=0)&&(n=0);document.getElementsByClassName("spread");this.page.style.left="0px"}},view_position:function(){var e=this.page,t=e.parentNode;if(doublePage){var i=t.parentNode;return[i.scrollLeft-e.offsetLeft-e.clientLeft,i.scrollTop-e.offsetTop-e.clientTop]}return[t.scrollLeft-e.offsetLeft-e.clientLeft,t.scrollTop-e.offsetTop-e.clientTop]},height:function(){return this.page.clientHeight},width:function(){return this.page.clientWidth}},Viewer.prototype={scale:1,cur_page_idx:0,first_page_idx:0,init_before_loading_content:function(){this.pre_hide_pages()},initialize_radio_button:function(){for(var e=document.getElementsByClassName(CSS_CLASS_NAMES.input_radio),t=0;t<e.length;t++){e[t].addEventListener("click",function(){this.classList.toggle("checked")})}},initEvents:function(e){var t=e?utils.removeEvent:utils.addEvent,i=utils.options.bindToWrapper?container:window;t(window,"orientationchange",handleEvent),t(window,"resize",handleEvent),utils.click&&t(container,"click",handleEvent,!0),utils.disableMouse||(t(i,"mousedown",handleEvent),t(i,"mousecancel",handleEvent),t(i,"mouseup",handleEvent)),utils.hasPointer&&!utils.disablePointer&&(t(container,utils.prefixPointerEvent("pointerdown"),handleEvent),t(i,utils.prefixPointerEvent("pointercancel"),handleEvent),t(i,utils.prefixPointerEvent("pointerup"),handleEvent))},init_after_loading_content:function(){this.sidebar=document.getElementById(this.config.sidebar_id),this.outline=document.getElementById(this.config.outline_id),container=this.container=document.getElementById(this.config.container_id),sidebar=document.getElementById(this.config.sidebar_id),topbar=document.getElementById(this.config.topbar_id),this.loading_indicator=document.getElementsByClassName(this.config.loading_indicator_cls)[0];var e=!0;if(this.outline)for(var t=this.outline.childNodes,i=0,a=t.length;i<a;++i){if("ul"===t[i].nodeName.toLowerCase()){e=!1;break}}if(e||this.sidebar.classList.add("opened"),this.find_pages(),0!=this.pages.length){disable_dragstart(document.getElementsByClassName(CSS_CLASS_NAMES.background_image)),this.config.key_handler&&this.register_key_handler();var n=this;this.config.hashchange_handler&&window.addEventListener("hashchange",function(e){n.navigate_to_dest(document.location.hash.substring(1))},!1),this.config.view_history_handler&&window.addEventListener("popstate",function(e){e.state&&n.navigate_to_dest(e.state)},!1),this.container.addEventListener("scroll",function(){1==EbookMode&&n.update_page_idx(),n.schedule_render(!0)},!1),this.initialize_radio_button(),this.render(),this.fit_width(),n.initEvents()}},find_pages:function(){for(var e=[],t={},i=this.container.childNodes,a=0,n=i.length;a<n;++a){var s=i[a];if(s.nodeType===Node.ELEMENT_NODE&&s.classList.contains(CSS_CLASS_NAMES.page_frame)){var o=new Page(s);e.push(o),t[o.num]=e.length-1}}this.pages=e,this.page_map=t},load_page:function(e,t,i){var a=this.pages;if(!(e>=a.length)){var n=a[e];if(!n.loaded&&!this.pages_loading[e]){var s=n.page,o=s.getAttribute("data-page-url");if(o){this.pages_loading[e]=!0;var r=s.getElementsByClassName(this.config.loading_indicator_cls)[0];void 0===r&&((r=this.loading_indicator.cloneNode(!0)).classList.add("active"),s.appendChild(r));var l=this,c=e,d=new XMLHttpRequest;d.open("GET",o,!0),d.onload=function(){if(200===d.status||0===d.status){var e=document.createElement("div");e.innerHTML=d.responseText;for(var t=null,a=e.childNodes,n=0,s=a.length;n<s;++n){var o=a[n];if(o.nodeType===Node.ELEMENT_NODE&&o.classList.contains(CSS_CLASS_NAMES.page_frame)){t=o;break}}var r=l.pages[c];l.container.replaceChild(t,r.page),r=new Page(t),l.pages[c]=r,r.hide(),r.rescale(l.scale),disable_dragstart(t.getElementsByClassName(CSS_CLASS_NAMES.background_image)),l.schedule_render(!1),i&&i(r)}delete l.pages_loading[c]},d.send(null)}if(void 0===t&&(t=this.config.preload_pages),--t>0){l=this;setTimeout(function(){l.load_page(e+1,t)},0)}}}},pre_hide_pages:function(){var e="@media screen{."+CSS_CLASS_NAMES.page_content_box+"{display:none;}}",t=document.createElement("style");t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e)),document.head.appendChild(t)},render:function(){for(var e=this.container,t=(e.scrollTop,e.clientHeight,this.cur_page_idx,this.pages),i=0,a=t.length;i<a;++i){this.config.preload_pages;if(this.cur_page_idx!=i){var n,s,o=t[this.cur_page_idx],r=o.page,l=t[i];r.offsetTop,r.clientTop,r.clientHeight;if(n=this.cur_page_idx<t.length-1?t[this.cur_page_idx+1]:t[t.length-1],s=this.cur_page_idx>0?t[this.cur_page_idx-1]:t[0],0==EbookMode){doublePage&&(this.cur_page_idx%2==0?n&&n.show():s&&s.show());var c=document.querySelectorAll(".spread.opened");c.length>0&&c.forEach(function(e,t,i){e.classList.remove("opened"),e.classList.add("closed")}),o.loaded&&(o.show(),o.page.parentNode.classList.contains("closed")&&(o.page.parentNode.classList.remove("closed"),o.page.parentNode.classList.add("opened"))),l.hide()}else t[i].loaded?t[i].show():this.load_page(i),n.show(),s.show(),doublePage&&this.cur_page_idx,o.loaded?o.show():this.load_page(i)}}},update_page_idx:function(){var e=this.pages,t=e.length;if(!(t<2)){for(var i=this.container,a=i.scrollTop,n=a+i.clientHeight,s=i.scrollLeft,o=s+i.clientWidth,r=-1,l=t,c=l-r;c>1;){var d=r+Math.floor(c/2);(u=e[d].page).offsetTop+u.clientTop+u.clientHeight>=a?l=d:r=d,c=l-r}this.first_page_idx=l;for(var h=this.cur_page_idx,p=h,g=[],_=l;_<t;++_){var u,f=(u=e[_].page).offsetTop+u.clientTop,v=u.clientHeight,m=f+v,w=u.offsetLeft+u.clientLeft,E=u.clientWidth,b=w+E;if(f>n)break;var y=(Math.min(n,m)-Math.max(a,f))/v,L=(Math.min(o,b)-Math.max(s,w))/E;if(_===h&&Math.abs(y-1)<=EPS){p=h;break}var S=i.clientHeight/v/2;doublePage&&(g[_]=Math.round(1e3*L)/1e3),y>S&&(p=_,doublePage&&(p=g[_]>g[_-1]?_:_-1))}this.cur_page_idx=p}},schedule_render:function(e){if(void 0!==this.render_timer){if(!e)return;clearTimeout(this.render_timer)}var t=this;this.render_timer=setTimeout(function(){delete t.render_timer,t.render()},this.config.render_timeout)},register_key_handler:function(){var e=this;window.addEventListener("DOMMouseScroll",function(t){if(t.ctrlKey){t.preventDefault();var i=e.container,a=i.getBoundingClientRect(),n=[t.clientX-a.left-i.clientLeft,t.clientY-a.top-i.clientTop];e.rescale(Math.pow(e.config.scale_step,t.detail),!0,n)}},!1),window.addEventListener("keydown",function(t){var i=!1,a=t.ctrlKey||t.metaKey,n=t.altKey;switch(t.keyCode){case 61:case 107:case 187:a&&(e.rescale(1/e.config.scale_step,!0),i=!0);break;case 173:case 109:case 189:a&&(e.rescale(e.config.scale_step,!0),i=!0);break;case 48:a&&(e.rescale(0,!1),i=!0);break;case 33:n?e.scroll_to(e.cur_page_idx-1):e.container.scrollTop-=e.container.clientHeight,i=!0;break;case 34:n?e.scroll_to(e.cur_page_idx+1):e.container.scrollTop+=e.container.clientHeight,i=!0;break;case 35:e.container.scrollTop=e.container.scrollHeight,i=!0;break;case 36:e.container.scrollTop=0,i=!0}i&&t.preventDefault()},!1)},rescale:function(e,t,i){var a=this.scale,n=a;0===e?(n=1,t=!1):t?n*=e:n=e,this.scale=n,i||(i=[0,0]),i[0]+=container.scrollLeft,i[1]+=container.scrollTop;for(var s=this.pages,o=s.length,r=this.first_page_idx;r<o;++r){var l=s[r].page;if(l.offsetTop+l.clientTop>=i[1])break}var c=r-1;c<0&&(c=0);var d=s[c].page,h=d.clientWidth,p=d.clientHeight,g=d.offsetLeft+d.clientLeft,_=i[0]-g;_<0?_=0:_>h&&(_=h);var u=d.offsetTop+d.clientTop,f=i[1]-u;f<0?f=0:f>p&&(f=p);for(r=0;r<o;++r)s[r].rescale(n,this);resetZoom&&(resetZoom=!1),container.scrollLeft+=_/a*n+d.offsetLeft+d.clientLeft-_-g,container.scrollTop=d.offsetTop+d.clientTop+f/a*n,this.schedule_render(!0)},_updateSpreadMode:function(e=!0){const t=this.pages;if(this._spreadMode="hr",doublePage){this._spreadMode;let i=null;for(let e=0,a=t.length;e<a;++e)e%2==0&&((i=document.createElement("div")).className="spread center ",container.appendChild(i)),0==EbookMode?e==this.cur_page_idx?i.className="spread opened":i.className="spread closed":i.className="spread opened",i.appendChild(t[e].page);e&&this.fit_width()}else{for(let e=0,i=t.length;e<i;++e)container.appendChild(t[e].page);for(var i=document.getElementsByClassName("spread");i.length>0;)i[0].parentNode.removeChild(i[0]);e&&this.fit_width()}},fit_width:function(e=!1,t=null){var i=this.cur_page_idx;t&&(i=t),e?doublePage?this.rescale(container.clientWidth/this.pages[i].width()/2,e):this.rescale(container.clientWidth/this.pages[i].width(),e):doublePage?this.rescale(container.clientWidth/this.pages[i].original_width/2,e):this.rescale(container.clientWidth/this.pages[i].original_width,e),this.scroll_to(i)},fit_height:function(e=!1){var t=this.cur_page_idx;e?this.rescale(container.clientHeight/this.pages[t].height(),e):this.rescale(container.clientHeight/this.pages[t].original_height,e),this.scroll_to(t)},get_containing_page:function(e){for(;e;){if(e.nodeType===Node.ELEMENT_NODE&&e.classList.contains(CSS_CLASS_NAMES.page_frame)){var t=get_page_number(e),i=this.page_map;return t in i?this.pages[i[t]]:null}e=e.parentNode}return null},link_handler:function(e){var t=e.target,i=t.getAttribute("data-dest-detail");if(i){if(this.config.view_history_handler)try{var a=this.get_current_view_hash();window.history.replaceState(a,"","#"+a),window.history.pushState(i,"","#"+i)}catch(e){}this.navigate_to_dest(i,this.get_containing_page(t)),e.preventDefault()}},navigate_to_dest:function(e,t){try{var i=JSON.parse(e)}catch(e){return}if(i instanceof Array){var a=i[0],n=this.page_map;if(a in n){for(var s=n[a],o=this.pages[s];i.length<7;)i.push(null);var r=t||this.pages[this.cur_page_idx],l=r.view_position();l=transform(r.ictm,[l[0],r.height()-l[1]]);var c=this.scale,d=[0,0],h=!0,p=!1;1!=i[5]&&0!=i[5]||doublePage!=i[5]&&(doublePage=i[5],this._updateSpreadMode(!1));var g=i[4];switch(i[1]){case"XYZ":d=[null===i[2]?l[0]:i[2]*g,null===i[3]?l[1]:i[3]*g],null!==(c=i[4])&&0!==c||(c=this.scale),p=!0;break;case"Fit":case"FitB":d=[0,0],p=!0;break;case"FitH":case"FitBH":d=[0,null===i[2]?l[1]:i[2]*g],p=!0;break;case"FitV":case"FitBV":d=[null===i[2]?l[0]:i[2]*g,0],p=!0;break;case"FitR":d=[i[2]*g,i[5]*g],h=!1,p=!0}if(p){this.rescale(c,!1);var _=this,u=function(e){if(d=transform(e.ctm,d),h&&(d[1]=e.height()-d[1]),i[6]){location.href;var t=document.getElementById(i[6]);t?t.scrollIntoView({block:"start",inline:"end"}):_.scroll_to(s,d)}else _.scroll_to(s,d)};o.loaded?(_.cur_page_idx=s,u(o)):(_.cur_page_idx=s,this.load_page(s,void 0,u),this.scroll_to(s)),_.schedule_render(!0)}}}},find_pagesIdx:function(e){var t=this.pages,i=0;return t.forEach(function(t,a){var n=t.page.getAttribute("id");e==n&&(i=a)}),i},scroll_to:function(e,t){var i,a=this.pages;e<0&&(e=0),e>=a.length&&(e=a.length-1),i=a[e].view_position(),void 0===t&&(t=[0,0]);var n=this.container,s=n.scrollLeft,o=n.scrollTop;s+=t[0]-i[0],o+=t[1]-i[1],1==EbookMode&&n.scroll(s,o),this.schedule_render(!0)},get_current_view_hash:function(){var e=[],t=this.pages[this.cur_page_idx],i=document.createElement("a");i.id="vw"+viewCounter,i.style.position="absolute",i.text=" ",document.querySelectorAll("#"+t.page.id+" .mlayer")[0].appendChild(i),viewCounter++,e.push(t.num),e.push("XYZ");var a=t.page,n=t.view_position();if(doublePage){var s=container.scrollLeft,o=s+container.clientWidth,r=a.offsetLeft+a.clientLeft,l=r+a.clientWidth;i.style.left=(Math.min(o,l)-Math.max(s,r))/this.scale+"px"}else i.style.left="0px";return i.style.top=n[1]/this.scale+"px",n=transform(t.ictm,[n[0],t.height()-n[1]]),e.push(n[0]/this.scale),e.push(n[1]/this.scale),e.push(this.scale),e.push(doublePage),e.push(i.id),JSON.stringify(e)}},pdfJs.Viewer=Viewer;